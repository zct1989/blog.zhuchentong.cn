(window.webpackJsonp=window.webpackJsonp||[]).push([[112],{429:function(n,e,a){"use strict";a.r(e);var t=a(39),o=Object(t.a)({},(function(){var n=this,e=n.$createElement,a=n._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":n.$parent.slotKey}},[a("p",[n._v("最近把公司的docker集群管理切换成了"),a("a",{attrs:{href:"https://www.goodrain.com/",target:"_blank",rel:"noopener noreferrer"}},[n._v("好雨云"),a("OutboundLink")],1),n._v("，经过一番折腾，总算基本可以项目正常部署了，就是不算很稳定("),a("em",[n._v("当然这可能和我服务器配置不高也有关系")]),n._v("),总是出现项目第一次或第二次编译不成功，但是再编译一次有好了的情况，觉得还是不够稳定(对比本地编译和daocloud)。不过这次要说的不是这个，是说说本地服务器部署外网访问的问题。")]),n._v(" "),a("p",[n._v("之前项目部署成功已经可以在内网正常访问了，当我把地址发给公司的测试的时候，测试告诉我我发送的地址外网无法访问，我试了一下确实无法访问，我联系好雨云的技术支持(他们的技术支持做的确实不错，专门建了一个微信群替我解答了许多问题)，他们让我看域名映射。")]),n._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v("ping 应用的域名\n")])])]),a("p",[n._v("果真返回的是安装好雨云管理节点的IP,它应该是根据主机IP直接生成的DNS映射。知道了就好，下来修改DNS映射的主机地址:")]),n._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v("grctl domain --ip 公司外网的固定IP\n")])])]),n._v(" "),a("p",[n._v("然后修改网管映射，修改外网的80端口映射到好雨云管理节点的80端口")]),n._v(" "),a("p",[n._v("大概就是这个逻辑映射到对应的端口:")]),n._v(" "),a("p",[a("img",{attrs:{src:"/images/20180903/%E5%A5%BD%E9%9B%A8%E4%BA%91%E7%BD%91%E7%BB%9C%E6%98%A0%E5%B0%84.png",alt:""}})]),n._v(" "),a("p",[n._v("然而一切还没有结束，因为我发现依然无法访问。。。")]),n._v(" "),a("p",[n._v("从外网telnet到ip的80端口,发现无法连接,打电话给电信，结果是因为主机没有备案，所以80端口是被封掉的状态，需要备案完成后联系电信开通。。。")]),n._v(" "),a("p",[n._v("好吧，这下才找到了问题，备案一时半会好不了，那么就有备用方案。")]),n._v(" "),a("p",[n._v("打开管理节点的"),a("code",[n._v("/opt/rainbond/compose_bak/ui.yaml")]),n._v("文件，这里存放了管理节点的数据库连接信息,根据"),a("code",[n._v("MYSQL_USER")]),n._v("和"),a("code",[n._v("MYSQL_PASS")]),n._v("连接数据库.")]),n._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v("version: '2.1'\nservices:\n  rbd-app-ui:\n    image: goodrain.me/rbd-app-ui:3.7\n    container_name: rbd-app-ui\n    environment:\n      MANAGE_SECRET_KEY: xxxx\n      MYSQL_HOST: xxx.xxx.xxx.xxx\n      MYSQL_PORT: xxxx\n      MYSQL_USER: xxxx\n      MYSQL_PASS: xxxx\n      MYSQL_DB: console\n    volumes:\n    - /grdata/services/console:/data\n    - /opt/rainbond/logs/rbd-app-ui/goodrain.log:/tmp/goodrain.log\n    logging:\n      driver: json-file\n      options:\n        max-size: 50m\n        max-file: '3'\n    network_mode: host\n    restart: always\n")])])]),a("p",[n._v("连接上数据库后，打开"),a("code",[n._v("region_info")]),n._v("表，这时配置数据中心的，其中有一个字段是"),a("code",[n._v("httpdomain")]),n._v("，这个是对应本地节点的域名，我闷在这个域名的后面加上"),a("code",[n._v(":8080")]),n._v("，现在就变成了"),a("code",[n._v("xxxx.goodrain.cn:8080")])]),n._v(" "),a("p",[n._v("然后将网关的8080端口映射到管理节点的80端口,这下再试一试，对应地址外网就可以访问了。")]),n._v(" "),a("p",[n._v("还是对很多基础的东西不熟悉，所以才搞了很久才搞好，还是要多学习。")])])}),[],!1,null,null,null);e.default=o.exports}}]);